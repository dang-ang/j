
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Grafico Parametri Giocatore</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background-color: #f0f0f0;
    }
    h2 {
      color: #333;
    }
    select {
      margin-right: 1rem;
      padding: 0.5rem;
    }
    canvas {
      margin-top: 2rem;
      max-width: 800px;
    }
  </style>
</head>
<body>
  <h2>Visualizza Parametri Giocatore</h2>

  <label for="nomeGiocatore">Nome:</label>
  <select id="nomeGiocatore">
    <option>AGRIGOROAEI</option>
    <option>AIT</option>
    <option>ARCIDIACONO</option>
    <option>BARUZZI</option>
    <option>BENALLAL</option>
    <option>BUSHI</option>
    <option>CENTANNI</option>
    <option>FALZONI</option>
    <option>FARINA</option>
    <option>FORESTIERO</option>
    <option>GALLALA</option>
    <option>GEMINIANI</option>
    <option>GNOFFO</option>
    <option>GRANO</option>
    <option>GRECA</option>
    <option>GUEYE</option>
    <option>IANIGRO</option>
    <option>MASHA</option>
    <option>MHILLAJ</option>
    <option>NDOJ</option>
    <option>ZITOUNI</option>
    <option>GIORDANO</option>
    <option>LANZA</option>
    <!-- Aggiungi altri nomi se necessario -->
  </select>

  <label for="parametro">Parametro:</label>
  <select id="parametro">
    <option value="attendance">PRESENZE</option>
    <option value="rpe">Sforzo</option>
    <option value="recovery">Recupero</option>
    <option value="fatigue">Stanchezza</option>
    <option value="weight">Peso</option>
    <option value="height">Altezza</option>
    <option value="balzo_alto">Balzo alto</option>
    <option value="balzo_avanti">Balzo avanti</option>
    <option value="cooper_6">Cooper</option>
    <option value="agility">Agilit√†</option>
  </select>

  <button onclick="caricaDati()">Genera Grafico</button>

  <canvas id="graficoParametri"></canvas>

  <script>
    // const endpoint = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"; // Inserisci il tuo URL Web App
    const endpoint = "https://script.google.com/macros/s/AKfycby-14UNnIFbdh9-O0kNXnJNENYGy7OceIIBNJ_tTa1lZQOWkAuHgvHIrL68TOadoYNv/exec"; // Inserisci il tuo URL Web App
//  https://script.google.com/macros/s/AKfycby-14UNnIFbdh9-O0kNXnJNENYGy7OceIIBNJ_tTa1lZQOWkAuHgvHIrL68TOadoYNv/exec?player=BUSHI&parameter=rpe

async function caricaDati() {
  const nome = document.getElementById("nomeGiocatore").value;
  const parametro = document.getElementById("parametro").value;

  try {
    const response = await fetch(`${endpoint}?player=${nome}&parameter=${parametro}`);
    const dati = await response.json();

    if (dati.error) {
      alert(dati.error);
      return;
    }

    const date = [];
    const valori = [];
    const target = [];
    let titoloData = "";

    dati.forEach(entry => {
      if (entry.player === nome) {
        const valoreNumerico = parseInt(entry.valore);
        const targetNumerico = parseInt(entry.Team);

        if (!isNaN(valoreNumerico)) {
          date.push(entry.data);
          valori.push(valoreNumerico);
          target.push(isNaN(targetNumerico) ? null : targetNumerico);
        }

        if (!titoloData && entry._Data_) {
          titoloData = entry._Data_;
        }
      }
    });

    disegnaGrafico(date, valori, target, parametro, nome, titoloData);
  } catch (error) {
    console.error("Errore nel recupero dei dati:", error);
    alert("Errore nel caricamento dei dati.");
  }
}

function disegnaGrafico(date, valori, target, parametro, nome, titoloData) {
  const ctx = document.getElementById("graficoParametri").getContext("2d");
  if (window.grafico) window.grafico.destroy();

  const datasets = [{
    label: `${nome}`,
    data: valori,
    type: "bar",
    backgroundColor: "rgba(54, 162, 235, 0.6)",
    borderColor: "rgba(54, 162, 235, 1)",
    borderWidth: 1
  }];


  const coloriTarget = target.map((t, i) => {
  const v = valori[i];
  if (t === null || v === null) return "rgba(200,200,200,0.5)";
  return v < t ? "rgba(255, 0, 0, 1)" : "rgba(0, 200, 0, 1)";
});

  if (parametro === "attendance" && target.length > 0) {
    datasets.push({
      label: "-",
      data: target,
      type: "line",
      showLine: false,
      pointStyle: "circle",
      pointRadius: 7,
      pointBackgroundColor: coloriTarget,
      pointBorderColor: coloriTarget,
      borderWidth: 0
    });

   

}

  window.grafico = new Chart(ctx, {
    type: "bar",
    data: {
      labels: date,
      datasets: datasets
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: parametro === "attendance" && titoloData !== "",
          text: parametro === "attendance" ? `Presenze - ${titoloData}` : `${parametro} - ${nome}`,
          font: { size: 18 }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const valore = context.raw;
              return valore === null ? "Dato mancante" : `${context.dataset.label}: ${valore}`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: parametro }
        },
        x: {
          title: { display: true, text: "Data" }
        }
      }
    }
  });
}

  </script>
</body>
</html>